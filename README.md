# fdtd3d stencil example

This is an [AlphaZ](https://github.com/CSU-CS-Melange/AlphaZ) implementation of the following 3D electrodynamics simulation from the MathWorks library:  
https://www.mathworks.com/matlabcentral/fileexchange/101664-fdtd-3d-and-2d-examples-ade-cpml-and-a-dielectric-region

The provided alphabets and compiler script files can be used to generate the `codegen/fdtd3d.c` file.
The wrapper file and Makefile were also generated by AlphaZ and then tweaked/hardcoded to set some of the physical parameters (e.g., `f0`, `Lf`, `CF`, etc. see MathWorks library files for more information about what these represent).

# dependencies

This has been tested on Linux and Mac. Minimally, the following tools must be installed in order to build and run the stencil code:
* gcc
* make

In order to digest the output and make pretty images, the following must be installed:
* python3
* numpy (python package)
* matplotlib (python package)

In order to make an even prettier animation, you need the following:
* ffmpeg

# usage

Use the provided `run.sh` script to compile and run the stencil, and generate images/animations. It has the following usage:
```
$ ./run.sh 
usage: ./run.sh T Nx Ny Nz Sx Sy Sz

Parameters:
    T        : number of time steps
    Nx,Ny,Nz : data grid size
    Sx,Sy,Sz : coordinates of energy source (0<=Si<Ni)
```

For example, the following...
```
$ ./run.sh 200 100 100 100 50 50 50
```
...builds and runs the stencil for 200 time steps using a data grid size of 100 by 100 by 100 with the energy source located at the point [x,y,z]=[50,50,50].
During the stencil execution, the data grid values are written to a file called `output.csv`.
Then the python code `codegen/plot.py` parses the output values, generates images, and if ffmpeg is installed then it generates an MP4 file called `sim.mp4` looking something like the GIF below.

![fdtd3d.gif](sim.gif)
